@echo off
SETLOCAL ENABLEDELAYEDEXPANSION

REM –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
chcp 65001 > nul

ECHO.
ECHO ==================================================
ECHO           –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–æ –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
ECHO ==================================================
ECHO.

REM –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Allure
ECHO üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Allure...
call mvn allure:clean > nul
IF %ERRORLEVEL% NEQ 0 (
    ECHO ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ Allure —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
    GOTO :EOF
)
ECHO ‚úÖ –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Allure –æ—á–∏—â–µ–Ω—ã.
ECHO.

REM –ú–∞—Å—Å–∏–≤ –±—Ä–∞—É–∑–µ—Ä–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
set BROWSERS=CHROME FIREFOX EDGE
set TOTAL_BROWSERS=3
set CURRENT_BROWSER=0

REM –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
set TOTAL_TESTS=0
set PASSED_TESTS=0
set FAILED_TESTS=0

ECHO üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–æ –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö...
ECHO üìã –ë—Ä–∞—É–∑–µ—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: %BROWSERS%
ECHO.

REM –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ –∫–∞–∂–¥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
for %%B in (%BROWSERS%) do (
    set /a CURRENT_BROWSER+=1
    ECHO.
    ECHO ==================================================
    ECHO           –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ %%B (%CURRENT_BROWSER%/%TOTAL_BROWSERS%)
    ECHO ==================================================
    ECHO.
    
    ECHO üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ %%B...
    
    REM –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ç–µ–∫—É—â–µ–º –±—Ä–∞—É–∑–µ—Ä–µ
    mvn test -Dtest="*MultiBrowser*" -Dbrowser.type=%%B -Dui.headless=false -Dallure.results.directory="%CD%\target\allure-results"
    
    REM –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    if %ERRORLEVEL% equ 0 (
        ECHO ‚úÖ –¢–µ—Å—Ç—ã –≤ %%B —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã.
        set /a PASSED_TESTS+=1
    ) else (
        ECHO ‚ö†Ô∏è –¢–µ—Å—Ç—ã –≤ %%B –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–∞–º–∏.
        set /a FAILED_TESTS+=1
    )
    
    set /a TOTAL_TESTS+=1
    
    ECHO.
    ECHO üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ %%B:
    ECHO    –£—Å–ø–µ—à–Ω–æ: %PASSED_TESTS%
    ECHO    –° –æ—à–∏–±–∫–∞–º–∏: %FAILED_TESTS%
    ECHO    –í—Å–µ–≥–æ: %TOTAL_TESTS%
    ECHO.
    
    REM –ü–∞—É–∑–∞ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–∞–º–∏
    ECHO ‚è≥ –ü–∞—É–∑–∞ 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º...
    timeout /t 5 /nobreak > nul
)

ECHO.
ECHO ==================================================
ECHO           –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
ECHO ==================================================
ECHO.
ECHO üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
ECHO    –í—Å–µ–≥–æ –±—Ä–∞—É–∑–µ—Ä–æ–≤: %TOTAL_TESTS%
ECHO    –£—Å–ø–µ—à–Ω–æ: %PASSED_TESTS%
ECHO    –° –æ—à–∏–±–∫–∞–º–∏: %FAILED_TESTS%
ECHO.

REM –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Allure –æ—Ç—á–µ—Ç–∞
ECHO üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ Allure –æ—Ç—á–µ—Ç–∞...
call mvn allure:report
IF %ERRORLEVEL% NEQ 0 (
    ECHO ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Allure –æ—Ç—á–µ—Ç–∞.
    GOTO :EOF
)
ECHO ‚úÖ Allure –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø–∞–ø–∫–µ target/allure-report.
ECHO.

REM –û—Ç–∫—Ä—ã—Ç–∏–µ Allure –æ—Ç—á–µ—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
ECHO üåê –û—Ç–∫—Ä—ã—Ç–∏–µ Allure –æ—Ç—á–µ—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ...
call allure serve "%CD%\target\allure-results"
IF %ERRORLEVEL% NEQ 0 (
    ECHO ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Allure –æ—Ç—á–µ—Ç–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Allure Commandline —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ PATH.
    ECHO    –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –æ—Ç—á–µ—Ç –≤—Ä—É—á–Ω—É—é, –ø–µ—Ä–µ–π–¥—è –≤ –ø–∞–ø–∫—É target/allure-report –∏ –æ—Ç–∫—Ä—ã–≤ index.html.
) ELSE (
    ECHO ‚úÖ Allure –æ—Ç—á–µ—Ç –æ—Ç–∫—Ä—ã—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
)
ECHO.

ECHO ==================================================
ECHO           –ó–∞–≤–µ—Ä—à–µ–Ω–æ
ECHO ==================================================
ECHO.

PAUSE
ENDLOCAL
